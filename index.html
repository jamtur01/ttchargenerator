<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tunnels & Trolls Character Generator</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cinzel:wght@600;900&family=Uncial+Antiqua&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <header role="banner">
        <h1>Tunnels & Trolls<br />Character Generator</h1>
        <p>Create your deluxe edition T&T character</p>
      </header>

      <main class="character-sheet" role="main" aria-label="Character sheet creation form">
        <!-- Documentation Section -->
        <section class="documentation" id="help-section" style="display: none" role="region" aria-labelledby="help-heading" aria-hidden="true">
          <h4 id="help-heading">Quick Guide</h4>
          <ul>
            <li>
              <strong>TARO (Triples Add and Roll Over):</strong> When you roll
              triples (e.g., 3,3,3) for any attribute, you're a Specialist! Keep
              rolling and adding until you don't get triples.
            </li>
            <li>
              <strong>Personal Adds:</strong> Only STR, DEX, SPD, and LK above
              12 contribute (+1 per point over 12)
            </li>
            <li>
              <strong>Kindred Modifiers:</strong> Non-humans use multiplicative
              modifiers (e.g., Dwarves get 2× STR)
            </li>
            <li><strong>Starting Gold:</strong> 3d6 × 10 gold pieces</li>
            <li>
              <strong>Talents:</strong> All characters start with 1 talent,
              Rogues get 2. +3 bonus to specific saving rolls.
            </li>
          </ul>
        </section>

        <section class="character-info" role="region" aria-labelledby="character-info-heading">
          <div class="section-header">
            <h2 id="character-info-heading">Character Information</h2>
            <div class="elaborations-toggle">
              <label class="toggle-switch">
                <input type="checkbox" id="elaborations-toggle" role="switch" aria-label="Enable elaborations" aria-describedby="toggle-help" />
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-label">Enable Elaborations</span>
              <span class="info-icon" id="info-icon" role="button" tabindex="0" aria-label="Toggle elaborations help" aria-expanded="false" aria-controls="toggle-help">ⓘ</span>
              <div class="toggle-help" id="toggle-help" style="display: none">
                Enables optional rules including additional kindreds, character
                types, and other expansions from the Elaborations section
              </div>
            </div>
          </div>
          <div class="field name-field">
            <label for="name">Name:</label>
            <div class="input-group">
              <input type="text" id="name" placeholder="Enter character name" aria-label="Character name" aria-required="false" />
              <button
                type="button"
                id="generate-name"
                class="btn btn-small"
                title="Generate a random fantasy name"
                aria-label="Generate random character name"
              >
                Random
              </button>
            </div>
          </div>
          <div class="info-grid">
            <div class="field">
              <label
                for="kindred"
                title="Different kindreds have multiplicative attribute modifiers"
                >Kindred:</label
              >
              <select id="kindred" aria-label="Character kindred (race)" aria-describedby="kindred-help">
                <option value="">Select Kindred</option>
              </select>
            </div>
            <div class="field">
              <label
                for="class"
                title="Your character's profession determines abilities and limitations"
                >Type:</label
              >
              <select id="class" aria-label="Character type (class)" aria-describedby="class-help">
                <option value="">Select Type</option>
              </select>
            </div>
            <div class="field">
              <label for="gender">Gender:</label>
              <select id="gender" aria-label="Character gender">
                <option value="">Select Gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="field">
              <label for="age">Age:</label>
              <input type="number" id="age" min="1" max="999" aria-label="Character age in years" />
            </div>
            <div class="field">
              <label
                for="height"
                title="Roll 3d6 on height/weight table or choose"
                >Height:</label
              >
              <input type="text" id="height" placeholder="e.g., 5'10&quot;" aria-label="Character height" aria-describedby="height-help" />
            </div>
            <div class="field">
              <label for="weight" title="Weight in pounds">Weight:</label>
              <div class="input-group">
                <input type="text" id="weight" placeholder="e.g., 165 lbs" aria-label="Character weight in pounds" />
                <button
                  type="button"
                  id="roll-height-weight"
                  class="btn btn-small"
                  title="Roll 3d6 for height and weight"
                  aria-label="Generate random height and weight"
                >
                  Generate
                </button>
              </div>
            </div>
            <div class="field">
              <label for="hair" title="Hair color and style">Hair:</label>
              <input type="text" id="hair" placeholder="e.g., Brown, long" aria-label="Hair color and style" />
            </div>
            <div class="field">
              <label for="level" title="Character experience level"
                >Level:</label
              >
              <input type="number" id="level" value="1" min="1" max="50" aria-label="Character experience level" />
            </div>
          </div>
          <div class="file-actions">
            <button
              id="export-character"
              class="btn btn-success"
              title="Save character to JSON file"
              aria-label="Export character data as JSON file"
            >
              Export as JSON
            </button>
            <button
              id="export-pdf"
              class="btn btn-success"
              title="Export character sheet as PDF"
              aria-label="Export character sheet as PDF document"
            >
              Export as PDF
            </button>
            <button
              id="import-character"
              class="btn btn-info"
              title="Load character from JSON file"
              aria-label="Import character from JSON file"
            >
              Import Character
            </button>
          </div>
        </section>

        <section class="attributes" role="region" aria-labelledby="attributes-heading">
          <h2 id="attributes-heading">Attributes</h2>
          <div class="attributes-grid">
            <div class="attribute-header">Attribute</div>
            <div class="attribute-header">Current</div>
            <div class="attribute-header">Max</div>

            <div
              class="attribute-name"
              title="Strength: Physical power, weapon requirements, carrying capacity"
            >
              STR (Strength)
            </div>
            <input
              type="number"
              id="str-current"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Strength current value"
            />
            <input
              type="number"
              id="str-max"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Strength maximum value"
            />

            <div
              class="attribute-name"
              title="Constitution: Health, endurance, damage capacity"
            >
              CON (Constitution)
            </div>
            <input
              type="number"
              id="con-current"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Constitution current value"
            />
            <input
              type="number"
              id="con-max"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Constitution maximum value"
            />

            <div
              class="attribute-name"
              title="Dexterity: Manual dexterity, agility, marksmanship"
            >
              DEX (Dexterity)
            </div>
            <input
              type="number"
              id="dex-current"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Dexterity current value"
            />
            <input
              type="number"
              id="dex-max"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Dexterity maximum value"
            />

            <div
              class="attribute-name"
              title="Speed: Reflexes, reaction time, combat initiative"
            >
              SPD (Speed)
            </div>
            <input
              type="number"
              id="spd-current"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Speed current value"
            />
            <input
              type="number"
              id="spd-max"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Speed maximum value"
            />

            <div
              class="attribute-name"
              title="Luck: Fortune, chance, combat effectiveness"
            >
              LK (Luck)
            </div>
            <input
              type="number"
              id="lk-current"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Luck current value"
            />
            <input
              type="number"
              id="lk-max"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Luck maximum value"
            />

            <div
              class="attribute-name"
              title="Intelligence: Reasoning, memory, problem-solving, spell requirements"
            >
              IQ (Intelligence)
            </div>
            <input
              type="number"
              id="iq-current"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Intelligence current value"
            />
            <input
              type="number"
              id="iq-max"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Intelligence maximum value"
            />

            <div
              class="attribute-name"
              title="Wizardry: Magical capacity (kremm/mana), spell power"
            >
              WIZ (Wizardry)
            </div>
            <input
              type="number"
              id="wiz-current"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Wizardry current value"
            />
            <input
              type="number"
              id="wiz-max"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Wizardry maximum value"
            />

            <div
              class="attribute-name"
              title="Charisma: Personal magnetism, leadership, attractiveness"
            >
              CHA (Charisma)
            </div>
            <input
              type="number"
              id="cha-current"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Charisma current value"
            />
            <input
              type="number"
              id="cha-max"
              class="attribute-input"
              min="1"
              max="999"
              aria-label="Charisma maximum value"
            />
          </div>

          <div class="attribute-summary">
            <div
              class="adds"
              title="Personal Adds = (STR-12) + (DEX-12) + (SPD-12) + (LK-12), only for values > 12"
            >
              Total ADDS: <span id="total-adds">0</span>
            </div>
            <div
              class="weight-possible"
              title="Weight Possible = STR × 10 pounds (maximum carrying capacity)"
            >
              Weight Possible: <span id="weight-possible">0</span> lbs
            </div>
          </div>
        </section>

        <section class="actions" role="region" aria-label="Dice rolling actions">
          <div class="action-buttons">
            <button
              id="roll-attributes"
              class="btn btn-primary"
              title="Roll 3d6 for each attribute with TARO for triples"
              aria-label="Roll new random attributes using 3d6"
            >
              Roll New Attributes
            </button>
            <button
              id="reroll-attributes"
              class="btn btn-secondary"
              title="Reroll all attributes and apply kindred modifiers"
              aria-label="Reroll all attributes with kindred modifiers"
            >
              Reroll All
            </button>
          </div>
        </section>

        <section class="abilities" id="abilities-section" role="region" aria-labelledby="abilities-heading">
          <h2 id="abilities-heading">Character Abilities</h2>
          <div class="info-box">
            <h4>Type & Kindred Abilities</h4>
            <ul id="abilities-list">
              <li class="no-abilities">
                Select a type and kindred to see abilities
              </li>
            </ul>
          </div>
        </section>

        <section class="talents" role="region" aria-labelledby="talents-heading">
          <h2 id="talents-heading">Talents</h2>
          <div class="info-box">
            <h4>Talent Rules</h4>
            <ul>
              <li>
                Characters start with <strong>1 talent</strong> (Rogues get
                <strong>2 talents</strong>)
              </li>
              <li>
                Talents provide <strong>+3 bonus</strong> to specific saving
                rolls when the relevant attribute is
                <strong>10 or higher</strong>
              </li>
              <li>
                New talents cost <strong>300 Adventure Points</strong> or are
                gained when leveling up
              </li>
              <li>
                Rogues get extra rogue-like talents (*) on
                <strong>even levels</strong>
              </li>
            </ul>
          </div>
          <div class="talents-container">
            <div class="talent-input">
              <select
                id="new-talent"
                title="Choose a talent that reflects your character's background and skills"
                aria-label="Select a talent to add"
              >
                <option value="">Select a talent</option>
              </select>
              <button id="add-talent" class="btn btn-small" aria-label="Add selected talent to character">Add Talent</button>
              <button
                id="random-talent"
                class="btn btn-small"
                title="Get a random talent"
                aria-label="Add random talent to character"
              >
                Random
              </button>
            </div>
            <div id="talents-list" class="talents-list"></div>
          </div>
        </section>

        <section class="equipment" role="region" aria-labelledby="equipment-heading">
          <h2 id="equipment-heading">Equipment</h2>
          <div class="equipment-grid">
            <div class="equipment-section">
              <h3>Weapons</h3>
              <div class="equipment-input">
                <div class="typeahead-container">
                  <input
                    type="text"
                    id="new-weapon"
                    placeholder="Weapon name"
                    title="Warriors get +1d6 per level with melee weapons"
                    autocomplete="off"
                    aria-label="Enter weapon name"
                    aria-autocomplete="list"
                    aria-controls="weapon-typeahead"
                  />
                  <div id="weapon-typeahead" class="typeahead-dropdown"></div>
                </div>
                <button id="add-weapon" class="btn btn-small" aria-label="Add weapon to equipment list">Add</button>
              </div>
              <div id="weapons-list" class="equipment-list"></div>
            </div>

            <div class="equipment-section">
              <h3>Armor</h3>
              <div class="equipment-input">
                <div class="typeahead-container">
                  <input
                    type="text"
                    id="new-armor"
                    placeholder="Armor name"
                    title="Warriors can double armor protection at cost of durability"
                    autocomplete="off"
                    aria-label="Enter armor name"
                    aria-autocomplete="list"
                    aria-controls="armor-typeahead"
                  />
                  <div id="armor-typeahead" class="typeahead-dropdown"></div>
                </div>
                <button id="add-armor" class="btn btn-small" aria-label="Add armor to equipment list">Add</button>
              </div>
              <div id="armor-list" class="equipment-list"></div>
            </div>

            <div class="equipment-section">
              <h3>Items</h3>
              <div class="equipment-input">
                <input
                  type="text"
                  id="new-item"
                  placeholder="Item name"
                  autocomplete="off"
                  aria-label="Enter item name"
                />
                <button id="add-item" class="btn btn-small" aria-label="Add item to equipment list">Add</button>
              </div>
              <div id="items-list" class="equipment-list"></div>
            </div>
          </div>

          <div class="money-section">
            <h3>Money</h3>
            <div class="money-input">
              <label
                for="gold"
                title="Starting gold = 3d6 × 10 (or kindred specific)"
                >Gold:</label
              >
              <input type="number" id="gold" min="0" value="0" aria-label="Gold pieces" />
            </div>
          </div>

          <div class="info-box">
            <h4>Starting Equipment by Type</h4>
            <ul id="starting-equipment-list">
              <!-- Dynamically populated -->
            </ul>
            <p class="equipment-note">
              Additional equipment can be purchased with starting gold or
              acquired during adventures.
            </p>
          </div>
        </section>
      </main>

      <!-- Help Button -->
      <button class="help-button" onclick="toggleHelp()" title="Show/Hide Help" aria-label="Toggle help section" aria-controls="help-section" aria-expanded="false">
        ?
      </button>
    </div>

    <!-- Footer with Copyright -->
    <footer class="copyright-footer" role="contentinfo" aria-label="Copyright and legal information">
      <p>
        Tunnels & Trolls™ and Deluxe Tunnels & Trolls™ are trademarks of Flying
        Buffalo Inc.
      </p>
      <p>
        © 2015 Ken St Andre, Liz Danforth, Rick Loomis, Steven Crompton & Jim
        Peters. All rights reserved.
      </p>
      <p>
        This character generator is an unofficial fan tool. Visit
        <a href="https://www.flyingbuffalo.com" target="_blank" rel="noopener"
          >www.flyingbuffalo.com</a
        >
        for official T&T products.
      </p>
      <p>
        Source code available at
        <a
          href="https://github.com/jamtur01/ttchargenerator"
          target="_blank"
          rel="noopener"
          >GitHub</a
        >
      </p>
    </footer>

    <script>
      function toggleHelp() {
        const helpSection = document.getElementById("help-section");
        const helpButton = document.querySelector('.help-button');
        const isVisible = helpSection.style.display !== "none";
        
        helpSection.style.display = isVisible ? "none" : "block";
        helpSection.setAttribute('aria-hidden', isVisible ? 'true' : 'false');
        helpButton.setAttribute('aria-expanded', !isVisible);
      }
    </script>
    <script src="dice.js"></script>
    <script src="equipment-data.js"></script>
    <script src="character.js"></script>
    <script src="pdf-generator.js"></script>
    <script src="app.js"></script>
  </body>
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function () {
      var t = document.createElement("script");
      t.type = "text/javascript";
      t.async = true;
      t.id = "gauges-tracker";
      t.setAttribute("data-site-id", "6885224b0d85105ccc28dc2f");
      t.setAttribute("data-track-path", "https://track.gaug.es/track.gif");
      t.src = "https://d2fuc4clr7gvcn.cloudfront.net/track.js";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
</html>
